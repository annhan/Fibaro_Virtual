{"name":"Clock NEW","type":"virtual_device","properties":{"deviceIcon":428,"currentIcon":"0","log":"","logTemp":"","mainLoop":"-- Will check if variables needed exist, else it will create them with default value 07:00\n-- Function in mainloop will run only 1 time\n\n-- Inspired by code from http://www.domotique-fibaro.fr/index.php/topic/3304-creation-auto-de-variable-avec-nom-id-virtual-device/\n-- 2015-03-05 Jonny Larsson (jompa68)\n\nlocal varName = {\"TimeSleep\"};\nlocal varValue = \"00\"\n\nfunction checkGlobalVariable(varName)\n-- Check if variable exist \nlocal HC2 = Net.FHttp(\"127.0.0.1\", 11111);\nfor i = 1,#varName do\n\t\tvarNames = varName[i];\n\t\tresponse ,status, errorCode = HC2:POST(\"/api/globalVariables/\"..varNames, json.encode({\n      \tname = varNames,\n      \tvalue = \"\",\n      \tisEnum = 1,\n      \tenumValues = {}\n    })\n);\n\n--Verification \nif status == \"200\" or status == \"201\" then\n\n  \t\tfibaro:sleep(800);\n  \t\tresponse ,status, errorCode = HC2:PUT(\"/api/globalVariables/\"..varNames, json.encode({\n        name = varNames,\n        value = varValue,\n        isEnum = false,\n        enumValues = {}\n      })\n  );\n  \tif status == \"200\" or status == \"201\" then\n    \tfibaro:debug(\"Variable '\" ..varNames.. \"' value : '\" ..varValue.. \"' was created successfully.\");\n  \t\telse\n    \tfibaro:debug(\"Uppdate - Error : \" ..status);\n  \tend\nelse\n  \tfibaro:debug(\"Variable \"..varNames.. \" already exist - Error : \" ..status);\nend\nend\nupdateVar = true\n\nend\n\n\n-- MAIN\nif not updateVar then\ncheckGlobalVariable(varName)\nelse break;\nend","ui.lblWakeUp.value":"03:10","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"WakeUp","name":"lblWakeUp","favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"+Hr","name":"btnHrUp","empty":false,"msg":"--[[\nWakeUp alarm clock\n-------------------------\noriginal by Ucciogenerale\ncontibutions from robmac Alarm for LUAScheduler for HC2 v1.3.1\n-------------------------\n--]]\n\nlocal alarmClockDevice = fibaro:getSelfId()\n\nlocal newora = fibaro:get(alarmClockDevice,\"ui.lblWakeUp.value\") \n\nif newora == \"\" then newora = \"00:00\" end\n\nlocal H = string.sub(newora, 1, 2) \nlocal M = string.sub(newora, 4, 5) \n\nif tonumber(H) < 23 \nthen \nH = tonumber(H) + 1 \nelse H = 0 \nend \n\nif string.len(H) < 2 \nthen H = string.format(\"%s%s\", '0', H) \nelse \nend \n\nnewora = string.format(\"%s:%s\", H, M) \nfibaro:call(alarmClockDevice, \"setProperty\", \"currentIcon\", 428)\nfibaro:call(alarmClockDevice,\"setProperty\",\"ui.lblWakeUp.value\", newora)\n","buttonIcon":0,"favourite":false,"main":true},{"id":3,"lua":true,"waitForResponse":false,"caption":"-Hr","name":"btnHrDn","empty":false,"msg":"local alarmClockDevice = fibaro:getSelfId()\n\nlocal newora = fibaro:get(alarmClockDevice,\"ui.lblWakeUp.value\") \nlocal H = string.sub(newora, 1, 2) \nlocal M = string.sub(newora, 4, 5) \n\nif tonumber(H) > 0 \nthen \nH = tonumber(H) - 1 \nelse H = 23 \nend \n\nif string.len(H) < 2 \nthen H = string.format(\"%s%s\", '0', H) \nelse \nend \n\nnewora = string.format(\"%s:%s\", H, M) \nfibaro:call(alarmClockDevice, \"setProperty\", \"currentIcon\", 428)\nfibaro:call(alarmClockDevice,\"setProperty\",\"ui.lblWakeUp.value\", newora)","buttonIcon":0,"favourite":false,"main":false},{"id":4,"lua":true,"waitForResponse":false,"caption":"+Min","name":"btnMinUp","empty":false,"msg":"local alarmClockDevice = fibaro:getSelfId()\n\nlocal newora = fibaro:get(alarmClockDevice,\"ui.lblWakeUp.value\") \nlocal H = string.sub(newora, 1, 2) \nlocal M = string.sub(newora, 4, 5) \n\nif tonumber(M) < 50 \nthen \nM = tonumber(M) + 5 \nelse M = 0 \nend \n\nif string.len(M) < 2 \nthen M = string.format(\"%s%s\", '0', M) \nelse \nend \n\nnewora = string.format(\"%s:%s\", H, M) \n\nfibaro:call(alarmClockDevice,\"setProperty\",\"ui.lblWakeUp.value\", newora)\n","buttonIcon":0,"favourite":false,"main":false},{"id":5,"lua":true,"waitForResponse":false,"caption":"-Min","name":"btnMinDn","empty":false,"msg":" local alarmClockDevice = fibaro:getSelfId()\n\nlocal newora = fibaro:get(alarmClockDevice,\"ui.lblWakeUp.value\") \nlocal H = string.sub(newora, 1, 2) \nlocal M = string.sub(newora, 4, 5) \n\nif tonumber(M) > 0 \nthen \nM = tonumber(M) - 5 \nelse M = 50 \nend \n\nif string.len(M) < 2 \nthen M = string.format(\"%s%s\", '0', M) \nelse \nend \n\nnewora = string.format(\"%s:%s\", H, M) \nfibaro:call(alarmClockDevice, \"setProperty\", \"currentIcon\", 428)\nfibaro:call(alarmClockDevice,\"setProperty\",\"ui.lblWakeUp.value\", newora)","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":6,"lua":true,"waitForResponse":false,"caption":"Save","name":"btnSave","empty":false,"msg":"local alarmClockDevice = fibaro:getSelfId()\nlocal alarmClockTime = \"TimeSleep\"\n\nlocal newora = fibaro:get(alarmClockDevice,\"ui.lblWakeUp.value\") \n\nfibaro:setGlobal(alarmClockTime, newora)\n","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}